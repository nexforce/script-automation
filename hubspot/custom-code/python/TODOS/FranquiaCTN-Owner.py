# [TODOS EMPREENDIMENTOS] Código de atribuição de proprietário do negócio a partir da Franquia CTN = Conhecida
# https://app.clickup.com/t/86a7mjbaq

import requests
import json
import os

def main(event):
    deal_id = event.get('inputFields').get('hs_object_id')
    franquia = event.get('inputFields').get('franquiactn')
    print(franquia)
    print(deal_id)
    api_key =os.getenv("NX_OPERATIONS")
    
    franchise_owner_map = {
        "472": 45724981,
        "455": 45741428,
        "436": 45816594,
        "509": 105448268,
        "550": 42617273,
        "418": 45758460,
        "517": 45713551,
        "364": 42593278,
        "97": 45816409,
        "479": 45744523,
        "415": 45725295,
        "327": 45713445,
        "159": 45696543,
        "314": 45701171,
        "406": 45816431,
        "476": 45729731,
        "388": 45713427,
        "124": 45714203,
        "434": 45784286,
        "416": 45713197,
        "554": 45724979,
        "382": 45709559,
        "53": 45701248,
        "394": 45721272,
        "565": 45765801,
        "440": 45742502,
        "471": 45725430,
        "457": 1032238020,
        "489": 45713520,
        "470": 45774974,
        "63": 45725238,
        "505": 45742345,
        "562": 45883557,
        "576": 45729483,
        "558": 45883443,
        "439": 45713143,
        "215": 45786721,
        "282": 45752286,
        "557": 45721651,
        "126": 45741190,
        "504": 130123351,
        "376": 45814046,
        "417": 45784187,
        "390": 42617116,
        "587": 45721321,
        "437": 45725673,
        "596": 45836696,
        "57": 45720541,
        "67": 45800628,
        "241": 45691150,
        "34": 45725313,
        "32": 45713702,
        "83": 45725301,
        "68": 45836935,
        "122": 45800679,
        "78": 45725127,
        "404": 45725255,
        "296": 45837028,
        "277": 42617415,
        "422": 45760285,
        "486": 45725829,
        "572": 45701494,
        "328": 45701075,
        "424": 45729703,
        "359": 45816459,
        "160": 45744352,
        "506": 42617726,
        "360": 45701472,
        "116": 45741708,
        "590": 45817400,
        "551": 45725807,
        "427": 42593512,
        "380": 45725815,
        "524": 45817297,
        "401": 45766283,
        "89": 38602085,
        "592": 45725112,
        "120": 45713543,
        "599": 45713673,
        "400": 45709535,
        "482": 45884242,
        "514": 45698175,
        "161": 45725471,
        "570": 45836941,
        "270": 45698197,
        "488": 45725495,
        "284": 45744697,
        "444": 45713544,
        "110": 45713467,
        "234": 45765801,
        "362": 45765718,
        "326": 45713467,
        "354": 45882520,
        "451": 45701391,
        "508": 45713467,
        "473": 45713553,
        "344": 45713441,
        "232": 45766075,
        "447": 45720738,
        "226": 42593512,
        "336": 45716329,
        "598": 45836836,
        "306": 45714095,
        "496": 45742832,
        "118": 45741564,
        "323": 45721641,
        "62": 45740891,
        "64": 45741835,
        "536": 45701485,
        "297": 45866755,
        "480": 45883654,
        "275": 45741182,
        "309": 45729552,
        "545": 45725240,
        "555": 45729741,
        "295": 45725299,
        "316": 45867288,
        "294": 45701174,
        "313": 45725818,
        "542": 45713548,
        "267": 45816498,
        "71": 45849924,
        "324": 45722237,
        "168": 45701114,
        "258": 45741668,
        "474": 45765692,
        "499": 45752662,
        "461": 45714028,
        "373": 45883436,
        "493": 45766258,
        "94": 45742345,
        "361": 45774974,
        "475": 45770334,
        "317": 45701181,
        "423": 45725449,
        "429": 45746781,
        "91": 45725826,
        "356": 45883551,
        "445": 52384679,
        "169": 42593646,
        "348": 45817400,
        "312": 42617273,
        "519": 45700783,
        "350": 45883286,
        "233": 45883557,
        "556": 483434675,
        "454": 52310823,
        "133": 45721505,
        "305": 45701171,
        "279": 38602085,
        "460": 57634437,
        "173": 45758460,
        "448": 53782743,
        "585": 166121737,
        "66": 45701391,
        "391": 45883497,
        "483": 87127143,
        "392": 45883654,
        "164": 45725495,
        "378": 45774912,
        "432": 45725390,
        "276": 45729483,
        "37": 735753021,
        "246": 45706572,
        "591": 604844754,
        "541": 130946650,
        "302": 45701174,
        "366": 45770425,
        "266": 45883443,
        "560": 235979765,
        "379": 45722009,
        "502": 105455504,
        "501": 105328329,
        "353": 45816511,
        "567": 408290469,
        "468": 85494643,
        "574": 508253457,
        "403": 45701127,
        "581": 630731136,
        "431": 45883655,
        "443": 50117009,
        "549": 158781477,
        "377": 45798517,
        "575": 521280828,
        "235": 45701189,
        "543": 45706679,
        "494": 98109505,
        "469": 73638327,
        "74": 45707005,
        "510": 105273183,
        "458": 100258366,
        "358": 45866737,
        "77": 45741668,
        "566": 408278117,
        "595": 75337355,
        "420": 45729520,
        "389": 45725449,
        "386": 45725449,
        "407": 45725634,
        "512": 105578649,
        "485": 99652755,
        "81": 45709559,
        "103": 45744523,
        "357": 45867269,
        "385": 45744754,
        "315": 42593544,
        "525": 107986806,
        "365": 45759401,
        "349": 45760285,
        "413": 45758611,
        "411": 45761749,
        "370": 45761828,
        "393": 45762072,
        "374": 45761960,
        "428": 45725294,
        "433": 47395345,
        "367": 45789531,
        "450": 56736643,
        "86": 45713795,
        "217": 45746781,
        "351": 45725673,
        "303": 45725815,
        "352": 45817297,
        "355": 45725847,
        "322": 130123351,
        "593": 628972731,
        "463": 98109716,
        "398": 45741610,
        "75": 45740891,
        "263": 45742832,
        "410": 45884595,
        "286": 45725818,
        "449": 70532981,
        "101": 45752286,
        "261": 45729741,
        "125": 45713673,
        "167": 45725127,
        "577": 580062993,
        "333": 45725222,
        "535": 115582224,
        "498": 88348021,
        "308": 45784069,
        "405": 45800970,
        "128": 42593160,
        "175": 42617415,
        "321": 45786435,
        "285": 45784286,
        "387": 45802083,
        "511": 105066625,
        "107": 269931136,
        "564": 269931136,
        "553": 181787286,
        "516": 105329311,
        "211": 45228918,
        "76": 45741182,
        "513": 105071236,
        "337": 45800628,
        "231": 45867288,
        "95": 45714203,
        "269": 45725807,
        "265": 45729731,
        "268": 45729703,
        "290": 45722237,
        "287": 45701450,
        "255": 45701223,
        "288": 45701229,
        "248": 45701472,
        "259": 42617726,
        "274": 45701485,
        "256": 45701248,
        "264": 45701494,
        "283": 45836470,
        "262": 45836696,
        "254": 45836941,
        "260": 45837028,
        "278": 45742727,
        "280": 45837265,
        "289": 45837983,
        "273": 45838268,
        "131": 45720554,
        "532": 157103123,
        "195": 45724979,
        "271": 45744697,
        "330": 45800679,
        "497": 82678083,
        "568": 416829595,
        "369": 45722743,
        "157": 45724981,
        "397": 45775202,
        "58": 45741186,
        "372": 45817360,
        "371": 45817597,
        "170": 45725226,
        "272": 45725227,
        "515": 105334935,
        "552": 165437795,
        "584": 971810447,
        "452": 56559641,
        "540": 130102078,
        "414": 45786627,
        "507": 90919021,
        "518": 106137121,
        "546": 45741189,
        "79": 45741190,
        "425": 45742286,
        "481": 91921460,
        "46": 42617116,
        "522": 105448035,
        "487": 106156455,
        "342": 45786721,
        "69": 45742319,
        "318": 45713553,
        "399": 45724974,
        "80": 45742323,
        "304": 45786985,
        "251": 45742496,
        "561": 239822867,
        "114": 45742502,
        "48": 45742506,
        "300": 45816594,
        "477": 99639972,
        "381": 45725072,
        "208": 45722747,
        "441": 51851062,
        "426": 45742506,
        "597": 45742506
    }
    
    owner_id = franchise_owner_map.get(franquia)
    
    if not owner_id:
        return {
            "outputFields": {
                "internal_id": None,
                "error": f"Franchise '{franquia}' not found in mapping"
            }
        }
    
    try:
        url = f"https://api.hubapi.com/crm/v3/objects/deals/{deal_id}"
        headers = {
            "Authorization": f"Bearer {api_key}",
            "Content-Type": "application/json"
        }
        data = {
            "properties": {
                "hubspot_owner_id": str(owner_id)
            }
        }
        
        response = requests.patch(url, headers=headers, data=json.dumps(data))
        
        if response.status_code == 200:
            return {
                "outputFields": {
                    "internal_id": owner_id,
                    "hubspot_owner_id": owner_id,
                    "status": "success",
                    "message": f"Owner ID updated successfully to {owner_id} for franchise {franquia}"
                }
            }
        else:
            return {
                "outputFields": {
                    "internal_id": owner_id,
                    "hubspot_owner_id": owner_id,
                    "status": "error",
                    "message": f"Failed to update owner ID. Status code: {response.status_code}",
                    "response": response.text
                }
            }
    except Exception as e:
        return {
            "outputFields": {
                "internal_id": owner_id,
                "hubspot_owner_id": owner_id,
                "status": "error",
                "message": f"An error occurred: {str(e)}"
            }
        }